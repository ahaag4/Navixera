<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>School Transport Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    :root {
      --primary: #4361ee;
      --secondary: #6c757d;
      --success: #28a745;
      --info: #17a2b8;
      --warning: #ffc107;
      --danger: #dc3545;
      --light: #f8f9fa;
      --dark: #343a40;
      --sidebar-width: 250px;
      --header-height: 70px;
      --card-radius: 12px;
      --transition: all 0.3s ease;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    body {
      background-color: #f5f7fb;
      color: #333;
      overflow-x: hidden;
    }

    /* Header Styles */
    .header {
      height: var(--header-height);
      background: white;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      display: flex;
      align-items: center;
      padding: 0 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      font-weight: 700;
      color: var(--primary);
      font-size: 1.4rem;
    }

    .logo i {
      margin-right: 10px;
      font-size: 1.6rem;
    }

    /* Sidebar Styles */
    .sidebar {
      position: fixed;
      top: var(--header-height);
      left: 0;
      height: calc(100vh - var(--header-height));
      width: var(--sidebar-width);
      background: white;
      box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
      transition: var(--transition);
      z-index: 900;
      overflow-y: auto;
    }

    .sidebar-menu {
      list-style: none;
      padding: 20px 0;
    }

    .sidebar-menu li {
      margin-bottom: 5px;
    }

    .sidebar-menu a {
      display: flex;
      align-items: center;
      padding: 12px 20px;
      color: #555;
      text-decoration: none;
      transition: var(--transition);
      border-left: 4px solid transparent;
    }

    .sidebar-menu a:hover, .sidebar-menu a.active {
      background: #f0f5ff;
      color: var(--primary);
      border-left-color: var(--primary);
    }

    .sidebar-menu i {
      margin-right: 10px;
      font-size: 1.2rem;
    }

    /* Main Content */
    .main-content {
      margin-left: var(--sidebar-width);
      margin-top: var(--header-height);
      padding: 20px;
      transition: var(--transition);
    }

    /* Card Styles */
    .card {
      background: white;
      border-radius: var(--card-radius);
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
      margin-bottom: 20px;
      border: none;
      transition: var(--transition);
    }

    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
    }

    .card-header {
      background: white;
      border-bottom: 1px solid #eee;
      padding: 15px 20px;
      font-weight: 600;
      border-radius: var(--card-radius) var(--card-radius) 0 0 !important;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .card-body {
      padding: 20px;
    }

    /* Map Container */
    #map {
      height: 400px;
      border-radius: var(--card-radius);
      z-index: 1;
    }

    /* Stats Cards */
    .stat-card {
      text-align: center;
      padding: 20px;
    }

    .stat-card i {
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: var(--primary);
    }

    .stat-card h2 {
      font-size: 2rem;
      font-weight: 700;
      margin-bottom: 5px;
    }

    .stat-card p {
      color: #6c757d;
      margin: 0;
    }

    /* Table Styles */
    .table th {
      font-weight: 600;
      background: #f8f9fa;
    }

    /* Action Buttons */
    .btn-action {
      padding: 0.25rem 0.5rem;
      font-size: 0.875rem;
      margin: 0 2px;
    }

    /* Modal Styles */
    .modal-content {
      border-radius: var(--card-radius);
      border: none;
    }

    /* Responsive Design */
    @media (max-width: 992px) {
      .sidebar {
        transform: translateX(-100%);
      }
      
      .sidebar.active {
        transform: translateX(0);
      }
      
      .main-content {
        margin-left: 0;
      }
      
      .menu-toggle {
        display: block !important;
      }
    }

    .menu-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 1.5rem;
      color: var(--dark);
      cursor: pointer;
      margin-right: 15px;
    }

    .overlay {
      display: none;
      position: fixed;
      top: var(--header-height);
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 800;
    }

    .overlay.active {
      display: block;
    }

    /* Badge Styles */
    .badge {
      padding: 6px 10px;
      border-radius: 20px;
      font-weight: 500;
    }

    /* Notification Bell */
    .notification-bell {
      position: relative;
      margin-right: 20px;
      cursor: pointer;
    }

    .notification-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--danger);
      color: white;
      border-radius: 50%;
      width: 18px;
      height: 18px;
      font-size: 0.7rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Loader */
    .loader {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid rgba(255,255,255,.3);
      border-radius: 50%;
      border-top-color: #fff;
      animation: spin 1s ease-in-out infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <button class="menu-toggle">
      <i class="bi bi-list"></i>
    </button>
    <div class="logo">
      <i class="bi bi-bus-front"></i>
      <span>SchoolTrans</span>
    </div>
    <div class="ms-auto d-flex align-items-center">
      <div class="notification-bell">
        <i class="bi bi-bell fs-5"></i>
        <span class="notification-badge">3</span>
      </div>
      <div class="dropdown">
        <button class="btn btn-sm btn-light dropdown-toggle" type="button" data-bs-toggle="dropdown">
          <i class="bi bi-person-circle me-1"></i> Admin User
        </button>
        <ul class="dropdown-menu dropdown-menu-end">
          <li><a class="dropdown-item" href="#"><i class="bi bi-person me-2"></i>Profile</a></li>
          <li><a class="dropdown-item" href="#"><i class="bi bi-gear me-2"></i>Settings</a></li>
          <li><hr class="dropdown-divider"></li>
          <li><a class="dropdown-item" href="#"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
        </ul>
      </div>
    </div>
  </header>

  <!-- Overlay -->
  <div class="overlay"></div>

  <!-- Sidebar -->
  <aside class="sidebar">
    <ul class="sidebar-menu">
      <li><a href="#" class="active"><i class="bi bi-speedometer2"></i> Dashboard</a></li>
      <li><a href="#"><i class="bi bi-geo-alt"></i> Live Tracking</a></li>
      <li><a href="#"><i class="bi bi-people"></i> Students</a></li>
      <li><a href="#"><i class="bi bi-truck"></i> Vehicles</a></li>
      <li><a href="#"><i class="bi bi-person-badge"></i> Drivers</a></li>
      <li><a href="#"><i class="bi bi-signpost-split"></i> Routes</a></li>
      <li><a href="#"><i class="bi bi-clock-history"></i> Schedule</a></li>
      <li><a href="#"><i class="bi bi-bar-chart"></i> Reports</a></li>
      <li><a href="#"><i class="bi bi-bell"></i> Notifications</a></li>
      <li><a href="#"><i class="bi bi-sliders"></i> Settings</a></li>
    </ul>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <div class="container-fluid">
      <!-- Page Title -->
      <div class="row mb-4">
        <div class="col-12">
          <h4 class="mb-0">Transport Dashboard</h4>
          <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="#">Home</a></li>
              <li class="breadcrumb-item active" aria-current="page">Dashboard</li>
            </ol>
          </nav>
        </div>
      </div>

      <!-- Stats Overview -->
      <div class="row">
        <div class="col-md-3 col-sm-6">
          <div class="card stat-card">
            <i class="bi bi-truck"></i>
            <h2 id="vehicles-count">0</h2>
            <p>Active Vehicles</p>
          </div>
        </div>
        <div class="col-md-3 col-sm-6">
          <div class="card stat-card">
            <i class="bi bi-people"></i>
            <h2 id="students-count">0</h2>
            <p>Students</p>
          </div>
        </div>
        <div class="col-md-3 col-sm-6">
          <div class="card stat-card">
            <i class="bi bi-person-badge"></i>
            <h2 id="drivers-count">0</h2>
            <p>Drivers</p>
          </div>
        </div>
        <div class="col-md-3 col-sm-6">
          <div class="card stat-card">
            <i class="bi bi-signpost-split"></i>
            <h2 id="routes-count">0</h2>
            <p>Routes</p>
          </div>
        </div>
      </div>

      <!-- Map and Status -->
      <div class="row">
        <div class="col-lg-8">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Live Vehicle Tracking</h5>
            </div>
            <div class="card-body">
              <div id="map"></div>
            </div>
          </div>
        </div>
        <div class="col-lg-4">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Vehicle Status</h5>
              <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addVehicleModal">
                <i class="bi bi-plus"></i> Add Vehicle
              </button>
            </div>
            <div class="card-body" id="vehicle-status-list">
              <!-- Vehicle status will be loaded here -->
            </div>
          </div>
        </div>
      </div>

      <!-- Vehicles Table -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Vehicle Management</h5>
              <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addVehicleModal">
                <i class="bi bi-plus"></i> Add Vehicle
              </button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Vehicle Number</th>
                      <th>Type</th>
                      <th>Capacity</th>
                      <th>Driver</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="vehicles-table">
                    <!-- Vehicles will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Drivers Table -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Driver Management</h5>
              <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addDriverModal">
                <i class="bi bi-plus"></i> Add Driver
              </button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>License</th>
                      <th>Contact</th>
                      <th>Assigned Vehicle</th>
                      <th>Status</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="drivers-table">
                    <!-- Drivers will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Routes Table -->
      <div class="row">
        <div class="col-12">
          <div class="card">
            <div class="card-header">
              <h5 class="mb-0">Route Management</h5>
              <button class="btn btn-sm btn-primary" data-bs-toggle="modal" data-bs-target="#addRouteModal">
                <i class="bi bi-plus"></i> Add Route
              </button>
            </div>
            <div class="card-body">
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead>
                    <tr>
                      <th>ID</th>
                      <th>Name</th>
                      <th>Stops</th>
                      <th>Distance</th>
                      <th>Estimated Time</th>
                      <th>Assigned Vehicle</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="routes-table">
                    <!-- Routes will be loaded here -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Add Vehicle Modal -->
  <div class="modal fade" id="addVehicleModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Vehicle</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="vehicleForm">
            <input type="hidden" id="vehicleId">
            <div class="mb-3">
              <label for="vehicleNumber" class="form-label">Vehicle Number</label>
              <input type="text" class="form-control" id="vehicleNumber" required>
            </div>
            <div class="mb-3">
              <label for="vehicleType" class="form-label">Type</label>
              <select class="form-select" id="vehicleType" required>
                <option value="">Select Type</option>
                <option value="Bus">Bus</option>
                <option value="Van">Van</option>
                <option value="Minibus">Minibus</option>
              </select>
            </div>
            <div class="mb-3">
              <label for="capacity" class="form-label">Capacity</label>
              <input type="number" class="form-control" id="capacity" required>
            </div>
            <div class="mb-3">
              <label for="driverId" class="form-label">Driver</label>
              <select class="form-select" id="driverId">
                <option value="">Select Driver</option>
                <!-- Drivers will be populated here -->
              </select>
            </div>
            <div class="mb-3">
              <label for="vehicleStatus" class="form-label">Status</label>
              <select class="form-select" id="vehicleStatus" required>
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
                <option value="Maintenance">Maintenance</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="saveVehicleBtn">Save Vehicle</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Driver Modal -->
  <div class="modal fade" id="addDriverModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Driver</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="driverForm">
            <input type="hidden" id="driverId">
            <div class="mb-3">
              <label for="driverName" class="form-label">Full Name</label>
              <input type="text" class="form-control" id="driverName" required>
            </div>
            <div class="mb-3">
              <label for="licenseNumber" class="form-label">License Number</label>
              <input type="text" class="form-control" id="licenseNumber" required>
            </div>
            <div class="mb-3">
              <label for="contactNumber" class="form-label">Contact Number</label>
              <input type="text" class="form-control" id="contactNumber" required>
            </div>
            <div class="mb-3">
              <label for="driverStatus" class="form-label">Status</label>
              <select class="form-select" id="driverStatus" required>
                <option value="Active">Active</option>
                <option value="Inactive">Inactive</option>
                <option value="On Leave">On Leave</option>
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="saveDriverBtn">Save Driver</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Add Route Modal -->
  <div class="modal fade" id="addRouteModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Add New Route</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <form id="routeForm">
            <input type="hidden" id="routeId">
            <div class="mb-3">
              <label for="routeName" class="form-label">Route Name</label>
              <input type="text" class="form-control" id="routeName" required>
            </div>
            <div class="mb-3">
              <label for="stops" class="form-label">Stops (comma separated)</label>
              <textarea class="form-control" id="stops" rows="3" required></textarea>
            </div>
            <div class="mb-3">
              <label for="distance" class="form-label">Distance (km)</label>
              <input type="number" class="form-control" id="distance" step="0.1" required>
            </div>
            <div class="mb-3">
              <label for="estimatedTime" class="form-label">Estimated Time (minutes)</label>
              <input type="number" class="form-control" id="estimatedTime" required>
            </div>
            <div class="mb-3">
              <label for="routeVehicleId" class="form-label">Assigned Vehicle</label>
              <select class="form-select" id="routeVehicleId">
                <option value="">Select Vehicle</option>
                <!-- Vehicles will be populated here -->
              </select>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-primary" id="saveRouteBtn">Save Route</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  
  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCn9YSO4-ksWl6JBqIcEEuLx2EJN8jMj4M",
      authDomain: "svms-c0232.firebaseapp.com",
      databaseURL: "https://svms-c0232-default-rtdb.firebaseio.com",
      projectId: "svms-c0232",
      storageBucket: "svms-c0232.appspot.com",
      messagingSenderId: "359201898609",
      appId: "1:359201898609:web:893ef076207abb06471bd0"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    document.addEventListener('DOMContentLoaded', function() {
      // Initialize map
      const map = L.map('map').setView([51.505, -0.09], 13);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
      }).addTo(map);

      // Mobile sidebar toggle
      const menuToggle = document.querySelector('.menu-toggle');
      const sidebar = document.querySelector('.sidebar');
      const overlay = document.querySelector('.overlay');

      menuToggle.addEventListener('click', function() {
        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
      });

      overlay.addEventListener('click', function() {
        sidebar.classList.remove('active');
        overlay.classList.remove('active');
      });

      // Modal instances
      const addVehicleModal = new bootstrap.Modal(document.getElementById('addVehicleModal'));
      const addDriverModal = new bootstrap.Modal(document.getElementById('addDriverModal'));
      const addRouteModal = new bootstrap.Modal(document.getElementById('addRouteModal'));

      // Firebase references
      const vehiclesRef = database.ref('vehicles');
      const driversRef = database.ref('drivers');
      const routesRef = database.ref('routes');

      // Load data from Firebase
      function loadData() {
        // Load vehicles
        vehiclesRef.on('value', (snapshot) => {
          const vehicles = snapshot.val() || {};
          const vehiclesTable = document.getElementById('vehicles-table');
          const vehicleStatusList = document.getElementById('vehicle-status-list');
          const vehiclesCount = document.getElementById('vehicles-count');
          const driverSelect = document.getElementById('driverId');
          const routeVehicleSelect = document.getElementById('routeVehicleId');
          
          // Update count
          vehiclesCount.textContent = Object.keys(vehicles).length;
          
          // Clear tables and selects
          vehiclesTable.innerHTML = '';
          vehicleStatusList.innerHTML = '';
          driverSelect.innerHTML = '<option value="">Select Driver</option>';
          routeVehicleSelect.innerHTML = '<option value="">Select Vehicle</option>';
          
          // Populate vehicles table and status list
          for (const id in vehicles) {
            const vehicle = vehicles[id];
            
            // Add to table
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${id}</td>
              <td>${vehicle.number}</td>
              <td>${vehicle.type}</td>
              <td>${vehicle.capacity}</td>
              <td>${vehicle.driver || 'Not assigned'}</td>
              <td><span class="badge bg-${getStatusBadgeColor(vehicle.status)}">${vehicle.status}</span></td>
              <td>
                <button class="btn btn-sm btn-outline-primary btn-action edit-vehicle" data-id="${id}">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger btn-action delete-vehicle" data-id="${id}">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            `;
            vehiclesTable.appendChild(row);
            
            // Add to status list if active
            if (vehicle.status === 'Active') {
              const statusItem = document.createElement('div');
              statusItem.className = 'd-flex justify-content-between align-items-center mb-3 p-2 bg-light rounded';
              statusItem.innerHTML = `
                <div>
                  <h6 class="mb-0">${vehicle.number}</h6>
                  <small>${vehicle.type} - Capacity: ${vehicle.capacity}</small>
                </div>
                <span class="badge bg-success">Active</span>
              `;
              vehicleStatusList.appendChild(statusItem);
            }
            
            // Add to driver select
            const driverOption = document.createElement('option');
            driverOption.value = id;
            driverOption.textContent = `${vehicle.number} (${vehicle.type})`;
            driverSelect.appendChild(driverOption);
            
            // Add to route vehicle select
            const routeOption = document.createElement('option');
            routeOption.value = id;
            routeOption.textContent = `${vehicle.number} (${vehicle.type})`;
            routeVehicleSelect.appendChild(routeOption);
          }
          
          // Add event listeners for edit and delete buttons
          document.querySelectorAll('.edit-vehicle').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const id = e.currentTarget.getAttribute('data-id');
              editVehicle(id, vehicles[id]);
            });
          });
          
          document.querySelectorAll('.delete-vehicle').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const id = e.currentTarget.getAttribute('data-id');
              deleteVehicle(id);
            });
          });
        });

        // Load drivers
        driversRef.on('value', (snapshot) => {
          const drivers = snapshot.val() || {};
          const driversTable = document.getElementById('drivers-table');
          const driversCount = document.getElementById('drivers-count');
          
          // Update count
          driversCount.textContent = Object.keys(drivers).length;
          
          // Clear table
          driversTable.innerHTML = '';
          
          // Populate drivers table
          for (const id in drivers) {
            const driver = drivers[id];
            
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${id}</td>
              <td>${driver.name}</td>
              <td>${driver.license}</td>
              <td>${driver.contact}</td>
              <td>${driver.assignedVehicle || 'Not assigned'}</td>
              <td><span class="badge bg-${getStatusBadgeColor(driver.status)}">${driver.status}</span></td>
              <td>
                <button class="btn btn-sm btn-outline-primary btn-action edit-driver" data-id="${id}">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger btn-action delete-driver" data-id="${id}">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            `;
            driversTable.appendChild(row);
          }
          
          // Add event listeners for edit and delete buttons
          document.querySelectorAll('.edit-driver').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const id = e.currentTarget.getAttribute('data-id');
              editDriver(id, drivers[id]);
            });
          });
          
          document.querySelectorAll('.delete-driver').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const id = e.currentTarget.getAttribute('data-id');
              deleteDriver(id);
            });
          });
        });

        // Load routes
        routesRef.on('value', (snapshot) => {
          const routes = snapshot.val() || {};
          const routesTable = document.getElementById('routes-table');
          const routesCount = document.getElementById('routes-count');
          
          // Update count
          routesCount.textContent = Object.keys(routes).length;
          
          // Clear table
          routesTable.innerHTML = '';
          
          // Populate routes table
          for (const id in routes) {
            const route = routes[id];
            
            const row = document.createElement('tr');
            row.innerHTML = `
              <td>${id}</td>
              <td>${route.name}</td>
              <td>${route.stops.split(',').length} stops</td>
              <td>${route.distance} km</td>
              <td>${route.estimatedTime} min</td>
              <td>${route.assignedVehicle || 'Not assigned'}</td>
              <td>
                <button class="btn btn-sm btn-outline-primary btn-action edit-route" data-id="${id}">
                  <i class="bi bi-pencil"></i>
                </button>
                <button class="btn btn-sm btn-outline-danger btn-action delete-route" data-id="${id}">
                  <i class="bi bi-trash"></i>
                </button>
              </td>
            `;
            routesTable.appendChild(row);
          }
          
          // Add event listeners for edit and delete buttons
          document.querySelectorAll('.edit-route').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const id = e.currentTarget.getAttribute('data-id');
              editRoute(id, routes[id]);
            });
          });
          
          document.querySelectorAll('.delete-route').forEach(btn => {
            btn.addEventListener('click', (e) => {
              const id = e.currentTarget.getAttribute('data-id');
              deleteRoute(id);
            });
          });
        });
      }

      // Helper function to get badge color based on status
      function getStatusBadgeColor(status) {
        switch (status) {
          case 'Active': return 'success';
          case 'Inactive': return 'secondary';
          case 'Maintenance': return 'warning';
          case 'On Leave': return 'info';
          default: return 'secondary';
        }
      }

      // Vehicle functions
      function editVehicle(id, vehicle) {
        document.getElementById('vehicleId').value = id;
        document.getElementById('vehicleNumber').value = vehicle.number;
        document.getElementById('vehicleType').value = vehicle.type;
        document.getElementById('capacity').value = vehicle.capacity;
        document.getElementById('driverId').value = vehicle.driverId || '';
        document.getElementById('vehicleStatus').value = vehicle.status;
        addVehicleModal.show();
      }

      function deleteVehicle(id) {
        if (confirm('Are you sure you want to delete this vehicle?')) {
          vehiclesRef.child(id).remove()
            .then(() => {
              alert('Vehicle deleted successfully');
            })
            .catch((error) => {
              alert('Error deleting vehicle: ' + error.message);
            });
        }
      }

      // Driver functions
      function editDriver(id, driver) {
        document.getElementById('driverId').value = id;
        document.getElementById('driverName').value = driver.name;
        document.getElementById('licenseNumber').value = driver.license;
        document.getElementById('contactNumber').value = driver.contact;
        document.getElementById('driverStatus').value = driver.status;
        addDriverModal.show();
      }

      function deleteDriver(id) {
        if (confirm('Are you sure you want to delete this driver?')) {
          driversRef.child(id).remove()
            .then(() => {
              alert('Driver deleted successfully');
            })
            .catch((error) => {
              alert('Error deleting driver: ' + error.message);
            });
        }
      }

      // Route functions
      function editRoute(id, route) {
        document.getElementById('routeId').value = id;
        document.getElementById('routeName').value = route.name;
        document.getElementById('stops').value = route.stops;
        document.getElementById('distance').value = route.distance;
        document.getElementById('estimatedTime').value = route.estimatedTime;
        document.getElementById('routeVehicleId').value = route.vehicleId || '';
        addRouteModal.show();
      }

      function deleteRoute(id) {
        if (confirm('Are you sure you want to delete this route?')) {
          routesRef.child(id).remove()
            .then(() => {
              alert('Route deleted successfully');
            })
            .catch((error) => {
              alert('Error deleting route: ' + error.message);
            });
        }
      }

      // Save vehicle
      document.getElementById('saveVehicleBtn').addEventListener('click', () => {
        const id = document.getElementById('vehicleId').value;
        const vehicleData = {
          number: document.getElementById('vehicleNumber').value,
          type: document.getElementById('vehicleType').value,
          capacity: document.getElementById('capacity').value,
          driverId: document.getElementById('driverId').value,
          status: document.getElementById('vehicleStatus').value,
          updatedAt: new Date().toISOString()
        };

        if (id) {
          // Update existing vehicle
          vehiclesRef.child(id).update(vehicleData)
            .then(() => {
              alert('Vehicle updated successfully');
              addVehicleModal.hide();
              document.getElementById('vehicleForm').reset();
            })
            .catch((error) => {
              alert('Error updating vehicle: ' + error.message);
            });
        } else {
          // Add new vehicle
          vehicleData.createdAt = new Date().toISOString();
          vehiclesRef.push(vehicleData)
            .then(() => {
              alert('Vehicle added successfully');
              addVehicleModal.hide();
              document.getElementById('vehicleForm').reset();
            })
            .catch((error) => {
              alert('Error adding vehicle: ' + error.message);
            });
        }
      });

      // Save driver
      document.getElementById('saveDriverBtn').addEventListener('click', () => {
        const id = document.getElementById('driverId').value;
        const driverData = {
          name: document.getElementById('driverName').value,
          license: document.getElementById('licenseNumber').value,
          contact: document.getElementById('contactNumber').value,
          status: document.getElementById('driverStatus').value,
          updatedAt: new Date().toISOString()
        };

        if (id) {
          // Update existing driver
          driversRef.child(id).update(driverData)
            .then(() => {
              alert('Driver updated successfully');
              addDriverModal.hide();
              document.getElementById('driverForm').reset();
            })
            .catch((error) => {
              alert('Error updating driver: ' + error.message);
            });
        } else {
          // Add new driver
          driverData.createdAt = new Date().toISOString();
          driversRef.push(driverData)
            .then(() => {
              alert('Driver added successfully');
              addDriverModal.hide();
              document.getElementById('driverForm').reset();
            })
            .catch((error) => {
              alert('Error adding driver: ' + error.message);
            });
        }
      });

      // Save route
      document.getElementById('saveRouteBtn').addEventListener('click', () => {
        const id = document.getElementById('routeId').value;
        const routeData = {
          name: document.getElementById('routeName').value,
          stops: document.getElementById('stops').value,
          distance: document.getElementById('distance').value,
          estimatedTime: document.getElementById('estimatedTime').value,
          vehicleId: document.getElementById('routeVehicleId').value,
          updatedAt: new Date().toISOString()
        };

        if (id) {
          // Update existing route
          routesRef.child(id).update(routeData)
            .then(() => {
              alert('Route updated successfully');
              addRouteModal.hide();
              document.getElementById('routeForm').reset();
            })
            .catch((error) => {
              alert('Error updating route: ' + error.message);
            });
        } else {
          // Add new route
          routeData.createdAt = new Date().toISOString();
          routesRef.push(routeData)
            .then(() => {
              alert('Route added successfully');
              addRouteModal.hide();
              document.getElementById('routeForm').reset();
            })
            .catch((error) => {
              alert('Error adding route: ' + error.message);
            });
        }
      });

      // Load initial data
      loadData();
    });
  </script>
</body>
  </html>
