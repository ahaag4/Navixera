<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="ProShop - Premium e-commerce platform with advanced features">
    <meta name="keywords" content="e-commerce, professional, shopping, responsive">
    <title>ProShop - Premium E-Commerce</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Roboto', sans-serif; background-color: #f3f4f6; color: #1f2937; line-height: 1.6; }
        .navbar { background-color: #1e3a8a; padding: 1rem 0; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .navbar-brand, .nav-link { color: #fff; font-weight: 700; transition: color 0.3s; }
        .nav-link:hover { color: #3b82f6; }
        .search-bar { width: 100%; margin: 10px 0; }
        .filter-section { margin: 20px 0; background: #fff; padding: 15px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin: 20px 0; }
        .product-card { background: #fff; border-radius: 8px; padding: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s; }
        .product-card img { width: 100%; height: 180px; object-fit: cover; border-radius: 4px; }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 6px 12px rgba(0,0,0,0.15); }
        .btn { transition: background-color 0.3s, transform 0.2s; min-width: 48px; min-height: 48px; }
        .btn:hover { transform: scale(1.05); }
        .modal-content { border-radius: 10px; }
        .modal-header { background: #1e3a8a; color: #fff; }
        .dashboard, .product-management { display: none; background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-top: 20px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }
        .loading { animation: pulse 1.5s infinite; }
        footer { background: #1e3a8a; color: #fff; padding: 20px 0; text-align: center; margin-top: 40px; }

        /* Responsive Design */
        @media (max-width: 767px) {
            .search-bar { width: 100%; }
            .product-grid { grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); }
            .navbar-brand { font-size: 1.2rem; }
            .btn { font-size: 0.9rem; padding: 8px 12px; }
        }
        @media (min-width: 768px) {
            .search-bar { width: 50%; }
            .product-grid { grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); }
            .dashboard, .product-management { display: block; }
        }
        @media (min-width: 992px) {
            .product-grid { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
            .btn { font-size: 1rem; padding: 10px 20px; }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">ProShop</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item"><a class="nav-link" href="#home">Home</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="categoryDropdown" role="button" data-bs-toggle="dropdown">Categories</a>
                        <ul class="dropdown-menu" aria-labelledby="categoryDropdown">
                            <li><a class="dropdown-item" href="#">Electronics</a></li>
                            <li><a class="dropdown-item" href="#">Clothing</a></li>
                            <li><a class="dropdown-item" href="#">Books</a></li>
                        </ul>
                    </li>
                    <li class="nav-item"><a class="nav-link" href="#cart">Cart</a></li>
                    <li class="nav-item"><a class="nav-link" href="#account">Account</a></li>
                </ul>
                <form class="d-flex search-bar">
                    <input class="form-control me-2" type="search" placeholder="Search products..." aria-label="Search">
                    <button class="btn btn-outline-light" type="submit">Search</button>
                </form>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mt-4">
        <!-- Filter Section -->
        <div class="filter-section">
            <select class="form-select mb-2" id="categoryFilter">
                <option value="">All Categories</option>
                <option value="electronics">Electronics</option>
                <option value="clothing">Clothing</option>
                <option value="books">Books</option>
            </select>
            <input type="number" class="form-control mb-2" id="priceFilter" placeholder="Max Price ($)">
            <button class="btn btn-primary" id="applyFilter">Apply Filter</button>
        </div>

        <!-- Product Grid -->
        <div class="product-grid" id="productGrid"></div>

        <!-- Product Modal -->
        <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="productModalLabel">Product Details</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <img id="modalImage" src="" alt="Product Image" class="img-fluid mb-3" style="animation: fadeIn 0.5s;">
                        <video id="modalVideo" controls style="display:none; width: 100%;"></video>
                        <p><strong>Description:</strong> <span id="modalDescription"></span></p>
                        <p><strong>Price:</strong> $<span id="modalPrice"></span></p>
                        <p><strong>Stock:</strong> <span id="modalStock"></span></p>
                        <a id="modalPDF" href="#" download class="btn btn-link">Download PDF</a>
                        <div id="modalReviews"></div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        <button class="btn btn-primary" id="addToCartBtn">Add to Cart</button>
                        <button class="btn btn-success" id="buyNowBtn">Buy Now</button>
                        <button class="btn btn-info" id="requestQuoteBtn">Request Quote</button>
                        <button class="btn btn-warning" id="bulkOrderBtn">Bulk Order</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Cart -->
        <div id="cart" class="mt-4">
            <h2>Shopping Cart</h2>
            <ul id="cartItems" class="list-group"></ul>
            <button class="btn btn-primary mt-2" id="checkoutBtn">Checkout</button>
        </div>

        <!-- Account Section -->
        <div id="account" class="mt-4">
            <h2>Account</h2>
            <p>Welcome, <span id="userEmail"></span>! <button class="btn btn-danger" id="logoutBtn">Logout</button></p>
            <div id="orderHistory"></div>
            <div id="dashboard" class="mt-4">
                <h3>Inventory Dashboard</h3>
                <ul id="inventoryList" class="list-group"></ul>
            </div>
            <div id="productManagement" class="mt-4">
                <h3>Manage Products</h3>
                <form id="productForm">
                    <div class="mb-2">
                        <input type="text" class="form-control" id="productName" placeholder="Product Name" required>
                    </div>
                    <div class="mb-2">
                        <input type="text" class="form-control" id="productCategory" placeholder="Category" required>
                    </div>
                    <div class="mb-2">
                        <input type="number" class="form-control" id="productPrice" placeholder="Price ($)" step="0.01" required>
                    </div>
                    <div class="mb-2">
                        <input type="number" class="form-control" id="productStock" placeholder="Stock" required>
                    </div>
                    <div class="mb-2">
                        <input type="url" class="form-control" id="productImage" placeholder="Image URL" required>
                    </div>
                    <div class="mb-2">
                        <input type="url" class="form-control" id="productVideo" placeholder="Video URL (optional)">
                    </div>
                    <div class="mb-2">
                        <input type="url" class="form-control" id="productPDF" placeholder="PDF URL (optional)">
                    </div>
                    <div class="mb-2">
                        <textarea class="form-control" id="productDescription" placeholder="Description" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">Add Product</button>
                </form>
                <select class="form-select mt-2" id="productSelect"></select>
                <button type="button" class="btn btn-danger mt-2" id="deleteProductBtn">Delete Product</button>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <p>&copy; 2025 ProShop. All rights reserved. | Last updated: 07:44 PM IST, August 18, 2025</p>
    </footer>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.0/firebase-database.js"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCn9YSO4-ksWl6JBqIcEEuLx2EJN8jMj4M",
            authDomain: "svms-c0232.firebaseapp.com",
            databaseURL: "https://svms-c0232-default-rtdb.firebaseio.com",
            projectId: "svms-c0232",
            storageBucket: "svms-c0232.appspot.com",
            messagingSenderId: "359201898609",
            appId: "1:359201898609:web:893ef076207abb06471bd0"
        };

        // Initialize Firebase
        try {
            firebase.initializeApp(firebaseConfig);
        } catch (error) {
            console.error("Firebase initialization error:", error);
            alert("Failed to initialize Firebase. Check console for details.");
            return;
        }
        const auth = firebase.auth();
        const db = firebase.database();
        const stripe = Stripe('pk_test_51J3fG2I8k3z9e4rX0q0s6xX8'); // Replace with live key

        // State Management
        let user = null;
        let cart = [];
        let products = [];

        // Load Products with Real-Time Updates
        function loadProducts() {
            document.getElementById('productGrid').classList.add('loading');
            db.ref('products').on('value', (snapshot) => {
                products = snapshot.val() ? Object.values(snapshot.val()) : [];
                renderProducts();
                populateProductSelect();
                document.getElementById('productGrid').classList.remove('loading');
            }, (error) => {
                console.error("Error loading products:", error);
                alert("Failed to load products. Check console for details.");
            });
        }

        // Render Products with Animation
        function renderProducts() {
            const productGrid = document.getElementById('productGrid');
            productGrid.innerHTML = '';
            const categoryFilter = document.getElementById('categoryFilter').value;
            const priceFilter = parseFloat(document.getElementById('priceFilter').value) || Infinity;

            products.filter(p => 
                (!categoryFilter || p.category === categoryFilter) && 
                (p.price <= priceFilter)
            ).forEach((product, index) => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.style.animation = `fadeIn 0.5s ease ${index * 0.1}s forwards`;
                card.innerHTML = `
                    <img src="${product.image}" alt="${product.name}" loading="lazy">
                    <h4>${product.name}</h4>
                    <p>$${product.price.toFixed(2)}</p>
                    <button class="btn btn-primary w-100" onclick="showProductModal('${product.id}')">View Details</button>
                `;
                productGrid.appendChild(card);
            });
        }

        // Product Modal
        function showProductModal(productId) {
            const product = products.find(p => p.id === productId);
            if (!product) return alert("Product not found");
            document.getElementById('modalImage').src = product.image || '';
            document.getElementById('modalVideo').src = product.video || '';
            document.getElementById('modalVideo').style.display = product.video ? 'block' : 'none';
            document.getElementById('modalDescription').textContent = product.description || 'No description available';
            document.getElementById('modalPrice').textContent = product.price ? product.price.toFixed(2) : 'N/A';
            document.getElementById('modalStock').textContent = product.stock || 'Out of stock';
            document.getElementById('modalPDF').href = product.pdf || '#';
            document.getElementById('modalPDF').style.display = product.pdf ? 'block' : 'none';
            document.getElementById('modalReviews').innerHTML = product.reviews?.map(r => `<div class="review">${r.text} <span>⭐${r.rating}</span></div>`).join('') || 'No reviews yet';
            document.getElementById('addToCartBtn').onclick = () => addToCart(productId);
            document.getElementById('buyNowBtn').onclick = () => checkout([productId]);
            document.getElementById('requestQuoteBtn').onclick = () => requestQuote(productId);
            document.getElementById('bulkOrderBtn').onclick = () => bulkOrder(productId);
            new bootstrap.Modal(document.getElementById('productModal')).show();
        }

        // Cart Management
        function addToCart(productId) {
            const product = products.find(p => p.id === productId);
            if (product) {
                cart.push(product);
                renderCart();
                alert(`${product.name} added to cart!`);
            } else {
                alert("Product not found in cart operation.");
            }
        }

        function renderCart() {
            const cartItems = document.getElementById('cartItems');
            cartItems.innerHTML = cart.map(p => `<li class="list-group-item">${p.name} - $${p.price.toFixed(2)} <button class="btn btn-danger btn-sm ms-2" onclick="removeFromCart('${p.id}')">Remove</button></li>`).join('');
        }

        function removeFromCart(productId) {
            cart = cart.filter(p => p.id !== productId);
            renderCart();
        }

        // Checkout
        function checkout(productIds) {
            if (!user) return alert('Please log in to proceed with checkout');
            const total = productIds.reduce((sum, id) => sum + (products.find(p => p.id === id)?.price || 0), 0);
            if (total > 0 && confirm(`Total: $${total.toFixed(2)}. Proceed to payment?`)) {
                stripe.createPaymentIntent({ amount: total * 100, currency: 'usd' })
                    .then(result => {
                        if (result.error) alert(`Payment error: ${result.error.message}`);
                        else {
                            db.ref(`users/${user.uid}/orders`).push({ products: productIds, total, date: new Date().toISOString() })
                                .then(() => {
                                    cart = [];
                                    renderCart();
                                    alert(`Payment successful! Order placed at 07:44 PM IST, August 18, 2025.`);
                                })
                                .catch(error => console.error("Order save error:", error));
                        }
                    })
                    .catch(error => console.error("Stripe error:", error));
                const upiLink = `upi://pay?pa=test@upi&am=${total}&cu=INR&tn=ProShop Purchase`;
                window.open(upiLink, '_blank');
            } else {
                alert("Invalid total amount or cart is empty.");
            }
        }

        // Request Quote
        function requestQuote(productId) {
            if (!user) return alert('Please log in to request a quote');
            const quantity = prompt('Enter quantity for quote:');
            if (quantity && !isNaN(quantity)) {
                db.ref(`users/${user.uid}/quotes`).push({ productId, quantity, date: new Date().toISOString() })
                    .then(() => alert('Quote request submitted at 07:44 PM IST, August 18, 2025!'))
                    .catch(error => console.error("Quote save error:", error));
            } else {
                alert("Please enter a valid quantity.");
            }
        }

        // Bulk Order
        function bulkOrder(productId) {
            if (!user) return alert('Please log in to place a bulk order');
            const quantity = prompt('Enter bulk quantity:');
            if (quantity && !isNaN(quantity) && confirm(`Order ${quantity} units of this product?`)) {
                db.ref(`users/${user.uid}/orders`).push({ productId, quantity, date: new Date().toISOString(), type: 'bulk' })
                    .then(() => alert('Bulk order placed at 07:44 PM IST, August 18, 2025!'))
                    .catch(error => console.error("Bulk order save error:", error));
            } else {
                alert("Please enter a valid quantity.");
            }
        }

        // Authentication and Role Check
        auth.onAuthStateChanged((u) => {
            user = u;
            if (user) {
                db.ref(`users/${user.uid}`).once('value').then((snapshot) => {
                    const userData = snapshot.val() || {};
                    const isSuperAdmin = userData.role === 'super-admin';
                    document.getElementById('userEmail').textContent = user.email;
                    document.getElementById('orderHistory').innerHTML = '<h4>Order History</h4>' + (Object.values(db.ref(`users/${user.uid}/orders`).val() || {}).map(o => `<p class="list-group-item">Order #${o.date}: $${o.total || 'Quote'}</p>`).join('') || '<p>No orders yet</p>');
                    document.getElementById('dashboard').style.display = user.email === 'admin@proshop.com' || isSuperAdmin ? 'block' : 'none';
                    document.getElementById('productManagement').style.display = isSuperAdmin ? 'block' : 'none';
                    loadInventory();
                }).catch(error => console.error("User data fetch error:", error));
            } else {
                document.getElementById('userEmail').textContent = 'Guest';
                document.getElementById('orderHistory').innerHTML = '';
                document.getElementById('dashboard').style.display = 'none';
                document.getElementById('productManagement').style.display = 'none';
            }
        });

        document.getElementById('logoutBtn').addEventListener('click', () => {
            auth.signOut().then(() => {
                alert('Logged out successfully at 07:44 PM IST, August 18, 2025.');
                location.reload();
            }).catch(error => console.error("Logout error:", error));
        });

        // Inventory Dashboard
        function loadInventory() {
            if (user && (user.role === 'super-admin' || (user.uid && db.ref(`users/${user.uid}`).once('value').then(s => s.val().role === 'super-admin')))) {
                db.ref('products').once('value').then((snapshot) => {
                    const inventory = snapshot.val() || [];
                    document.getElementById('inventoryList').innerHTML = inventory.map(p => `<li class="list-group-item">${p.name} - Stock: ${p.stock}</li>`).join('') || '<li>No products available</li>';
                }).catch(error => console.error("Inventory load error:", error));
            }
        }

        // Product Management
        function populateProductSelect() {
            const select = document.getElementById('productSelect');
            select.innerHTML = '<option value="">Select Product to Delete</option>';
            products.forEach(p => {
                const option = document.createElement('option');
                option.value = p.id;
                option.textContent = p.name;
                select.appendChild(option);
            });
        }

        document.getElementById('productForm').addEventListener('submit', (e) => {
            e.preventDefault();
            if (!user || (db.ref(`users/${user.uid}`).once('value').then(s => s.val().role) !== 'super-admin')) {
                alert('Super-admin access required to add products');
                return;
            }
            const newProduct = {
                id: `prod_${Date.now()}`,
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                price: parseFloat(document.getElementById('productPrice').value) || 0,
                stock: parseInt(document.getElementById('productStock').value) || 0,
                image: document.getElementById('productImage').value,
                video: document.getElementById('productVideo').value || null,
                pdf: document.getElementById('productPDF').value || null,
                description: document.getElementById('productDescription').value,
                reviews: []
            };
            db.ref('products').push(newProduct)
                .then(() => {
                    alert(`Product added successfully at 07:44 PM IST, August 18, 2025!`);
                    document.getElementById('productForm').reset();
                    // Real-time listener handles rendering
                })
                .catch(error => console.error("Product add error:", error));
        });

        document.getElementById('deleteProductBtn').addEventListener('click', () => {
            if (!user || (db.ref(`users/${user.uid}`).once('value').then(s => s.val().role) !== 'super-admin')) {
                alert('Super-admin access required to delete products');
                return;
            }
            const productId = document.getElementById('productSelect').value;
            if (productId) {
                if (confirm('Are you sure you want to delete this product?')) {
                    db.ref(`products/${productId}`).remove()
                        .then(() => alert(`Product deleted at 07:44 PM IST, August 18, 2025!`))
                        .catch(error => console.error("Product delete error:", error));
                }
            } else {
                alert('Please select a product to delete');
            }
        });

        // Filters
        document.getElementById('applyFilter').addEventListener('click', renderProducts);

        // Analytics (Simulated)
        setInterval(() => {
            console.log(`Analytics at 07:44 PM IST, August 18, 2025: Total Views: ${Math.floor(Math.random() * 1000)}`);
        }, 60000);

        // Integration Points (Simulated)
        function integrateWithCRM() {
            console.log('Integrating with CRM at 07:44 PM IST, August 18, 2025...');
        }

        // Initial Load
        window.onload = () => {
            loadProducts();
            if (!firebase.apps.length) {
                console.error("Firebase not initialized properly");
                alert("Firebase initialization failed. Please refresh the page or check your configuration.");
            }
        };
    </script>
</body>
        </html>
