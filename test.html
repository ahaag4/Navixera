<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Tracker Dashboard</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.css" />
  <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-draw@1.0.4/dist/leaflet.draw.js"></script>
  <script src="https://unpkg.com/leaflet-pip@1.1.0/leaflet-pip.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://js.stripe.com/v3/"></script>
  <style>
    html, body, #app { height: 100%; margin: 0; font-family: Arial, sans-serif; }
    #map { height: 400px; width: 100%; }
    #adArea { display: flex; justify-content: center; align-items: center; height: 100px; background: #f0f0f0; margin-bottom: 10px; }
    #adArea img, #adArea video { max-width: 100%; max-height: 100%; }
    .container { max-width: 1200px; margin: 0 auto; padding: 10px; }
    .card { border: 1px solid #ddd; border-radius: 8px; padding: 15px; margin-bottom: 15px; }
    .card-header { font-size: 1.2em; font-weight: bold; margin-bottom: 10px; }
    .card-body { display: flex; flex-direction: column; gap: 10px; }
    .badge { padding: 5px 10px; border-radius: 12px; font-size: 0.9em; }
    .badge.online { background: #28a745; color: white; }
    .badge.offline { background: #dc3545; color: white; }
    .comp-ok { color: #28a745; }
    .comp-warn { color: #ffc107; }
    .comp-bad { color: #dc3545; }
    .comp-unknown { color: #6c757d; }
    .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; }
    .btn-primary { background: #007bff; color: white; }
    .btn-warning { background: #ffc107; color: black; }
    .btn-danger { background: #dc3545; color: white; }
    .btn-ghost { background: #f8f9fa; color: #007bff; border: 1px solid #007bff; }
    .view-btn { background: #007bff; color: white; border: none; padding: 5px 10px; border-radius: 4px; }
    .approved-pill { background: #28a745; color: white; padding: 5px 10px; border-radius: 12px; }
    .pending-pill { background: #ffc107; color: black; padding: 5px 10px; border-radius: 12px; }
    .rejected-pill { background: #dc3545; color: white; padding: 5px 10px; border-radius: 12px; }
    .small-muted { color: #6c757d; font-size: 0.9em; }
    #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; }
    #modalContent { background: white; padding: 20px; border-radius: 8px; max-width: 500px; width: 90%; }
    #modalClose { float: right; cursor: pointer; font-size: 1.2em; }
    #history { width: 100%; border-collapse: collapse; }
    #history th, #history td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    #history th { background: #f8f9fa; }
  </style>
</head>
<body>
  <div id="app" class="container">
    <div id="adArea"></div>
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
      <h1>Smart Tracker Dashboard <span id="planPill" class="badge"></span></h1>
      <span id="userEmail"></span>
    </div>

    <div class="card">
      <div class="card-header">Vehicle Status <span id="planPillHeader" class="badge"></span></div>
      <div class="card-body">
        <p><strong>Location:</strong> <span id="location">Loading...</span></p>
        <p><strong>Last Active:</strong> <span id="lastActive">Loading...</span></p>
        <p><strong>Status:</strong> <span id="status">Loading...</span></p>
        <p><strong>Battery Health:</strong> <span id="batteryHealth">Loading...</span></p>
        <p><strong>Online:</strong> <span id="onlineStatus">Loading...</span></p>
        <p><strong>Last Seen:</strong> <span id="lastSeen">Loading...</span></p>
        <p><strong>Components:</strong> <ul id="componentsList"></ul></p>
        <p><strong>Alarm:</strong> <span id="alarmStatusText">Loading...</span> <input type="checkbox" id="alarmToggle"></p>
        <p><strong>Last Alarm Trigger:</strong> <span id="alarmTrigger">Loading...</span></p>
      </div>
    </div>

    <div class="card">
      <div class="card-header">Map</div>
      <div class="card-body">
        <div id="map"></div>
        <div id="mapTypeBlock" style="display: none; margin-top: 10px;">
          <label for="mapType">Map Type:</label>
          <select id="mapType">
            <option value="street">Street</option>
            <option value="satellite">Satellite</option>
            <option value="dark">Dark</option>
          </select>
        </div>
        <div id="heatToggleBlock" style="display: none; margin-top: 10px;">
          <label><input type="checkbox" id="heatToggle"> Show Heatmap</label>
        </div>
        <div id="customIconBlock" style="display: none; margin-top: 10px;">
          <label for="iconUploader">Custom Marker Icon:</label>
          <input type="file" id="iconUploader" accept="image/*">
        </div>
        <div id="geofenceControls" style="display: none; margin-top: 10px;">
          <button id="gfEnableDraw" class="btn btn-primary">Enable Draw</button>
          <button id="gfSave" class="btn btn-primary">Save Geofences</button>
          <button id="gfClear" class="btn btn-danger">Clear Geofences</button>
          <span id="gfHint" class="small-muted"></span>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">History</div>
      <div class="card-body">
        <div id="dateFilterSection" style="display: none; margin-bottom: 10px;">
          <label for="startDate">Start Date:</label>
          <input type="date" id="startDate">
          <label for="endDate">End Date:</label>
          <input type="date" id="endDate">
          <button id="applyFilterBtn" class="btn btn-primary">Apply Filter</button>
          <button id="clearFilterBtn" class="btn btn-ghost">Clear</button>
        </div>
        <table id="history">
          <thead>
            <tr><th>Time</th><th>Location</th><th>Action</th></tr>
          </thead>
          <tbody id="historyTbody"></tbody>
        </table>
        <button id="exportCSVBtn" class="btn btn-primary" style="margin-top: 10px; display: none;">Export as CSV</button>
      </div>
    </div>

    <div class="card">
      <div class="card-header">Key Metrics</div>
      <div class="card-body">
        <p><strong>Total Distance:</strong> <span id="kpiDistance">0.00 km</span></p>
        <p><strong>Stops:</strong> <span id="kpiStops">0</span></p>
        <p><strong>Refresh Rate:</strong> <span id="kpiRefresh">30s</span></p>
      </div>
    </div>

    <div class="card">
      <div class="card-header">Analytics</div>
      <div id="analyticsSection" style="display: none;">
        <p id="analyticsMessage">Analytics unavailable</p>
        <canvas id="analyticsChart"></canvas>
      </div>
    </div>

    <div class="card">
      <div class="card-header">Fleet Management</div>
      <div id="fleetSection" style="display: none;">
        <p id="fleetMessage">Fleet management unavailable</p>
        <button id="addVehicleBtn" class="btn btn-primary" style="display: none;">Add Vehicle</button>
        <ul id="fleetList"></ul>
      </div>
    </div>

    <div class="card">
      <div class="card-header">Subscription</div>
      <div class="card-body">
        <p><strong>Current Plan:</strong> <span id="currentPlan">Loading...</span></p>
        <p><strong>Plan Expiry:</strong> <span id="planExpiry">Loading...</span></p>
        <p><strong>Vehicle Limit:</strong> <span id="vehicleLimit">Loading...</span></p>
        <div id="requestStatusArea"></div>
        <div id="upgradeBtns" style="margin-left: auto;">
          <button id="upgradeToSilver" class="btn btn-warning">Request Silver (₹199/mo)</button>
          <button id="upgradeToGold" class="btn btn-primary">Request Gold (₹299/mo)</button>
          <button id="watchAdBtn" class="btn btn-ghost">Watch Ad for Premium</button>
          <button id="buyExportBtn" class="btn btn-primary" style="display: none;">Buy Export (₹149)</button>
          <button id="buyAnalyticsBtn" class="btn btn-primary" style="display: none;">Buy Analytics (₹299)</button>
          <button id="buyFleetBtn" class="btn btn-primary" style="display: none;">Buy Fleet (₹999)</button>
        </div>
      </div>
    </div>

    <div id="adminPanel" class="card" style="display: none;">
      <div class="card-header">Admin: Upgrade Requests</div>
      <div class="card-body">
        <div id="adminList"></div>
        <p><strong>Recent Actions:</strong></p>
        <div id="adminLogs"></div>
      </div>
    </div>

    <div id="adminPanelPayments" class="card" style="display: none;">
      <div class="card-header">Admin: Payments</div>
      <div class="card-body">
        <div id="paymentList"></div>
      </div>
    </div>

    <div id="modal">
      <div id="modalContent">
        <span id="modalClose">&times;</span>
        <p>Loading...</p>
        <button id="modalPayUPI" class="btn btn-primary">Pay with UPI</button>
        <button id="modalPayStripe" class="btn btn-primary">Pay with Card</button>
      </div>
    </div>
  </div>

  <script src="test.js"></script>
</body>
            </html>
