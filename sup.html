<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Super Admin - SVMS (Realtime DB) - Fixed</title>

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <style>
    body{background:#f8f9fa}
    .navbar{background:#0d6efd}
    .navbar-brand{color:#fff!important;font-weight:600}
    .card{border-radius:10px;box-shadow:0 2px 8px rgba(0,0,0,.05)}
    #map,#historyMap{height:400px;border-radius:8px}
    .stat-card{text-align:center;padding:18px;background:#fff;border-radius:10px}
    #debugLog{height:110px;overflow:auto;background:#fff;padding:10px;border-radius:6px;border:1px solid #e6e6e6;font-size:12px}
  </style>
</head>
<body>
  <nav class="navbar px-3">
    <a class="navbar-brand">Super Admin - SVMS (Realtime DB)</a>
    <button class="btn btn-light ms-auto" id="logoutBtn">Logout</button>
  </nav>

  <div class="container py-4">
    <div class="mb-3">
      <strong>Debug (visible):</strong>
      <pre id="debugLog">Loading...</pre>
    </div>

    <!-- Stats -->
    <div class="row g-3 mb-4">
      <div class="col-6 col-md-3"><div class="stat-card"><h3 id="totalCompanies">0</h3><p>Total Companies</p></div></div>
      <div class="col-6 col-md-3"><div class="stat-card"><h3 id="totalVehicles">0</h3><p>Total Vehicles</p></div></div>
      <div class="col-6 col-md-3"><div class="stat-card"><h3 id="totalDeliveries">0</h3><p>Total Deliveries</p></div></div>
      <div class="col-6 col-md-3"><div class="stat-card"><h3 id="alertsToday">0</h3><p>Alerts Today</p></div></div>
    </div>

    <!-- Live map -->
    <div class="card mb-4"><div class="card-body"><h5>Live Vehicle Locations</h5><div id="map"></div></div></div>

    <!-- Pending approvals -->
    <div class="card mb-4">
      <div class="card-body">
        <h5>Pending Approvals</h5>
        <ul class="list-group" id="pendingUsersList"></ul>
      </div>
    </div>
    <div class="card mb-4">
      <div class="card-body">
        <h5>Subscription Pending Approvals</h5>
        <a href="subscription.html" target="_blank">Open</a>
      </div>
    </div>

    <!-- Ads management (kept as before) -->
    <div class="card mb-4">
      <div class="card-body">
        <h5>Ads Management</h5>
        <p class="small text-muted">You can upload a banner image or video file, or provide a direct URL. Choose placement and toggle active.</p>

        <div class="row g-2">
          <div class="col-md-4">
            <label class="form-label">Ad Type</label>
            <select id="adType" class="form-select">
              <option value="banner">Banner (image)</option>
              <option value="video">Video</option>
            </select>
          </div>

          <div class="col-md-4">
            <label class="form-label">Upload File</label>
            <input id="adFile" type="file" class="form-control"/>
            <div class="form-text">File will be uploaded to Firebase Storage.</div>
          </div>

          <div class="col-md-4">
            <label class="form-label">Or Media URL</label>
            <input id="adUrl" class="form-control" placeholder="https://... (optional)"/>
          </div>

          <div class="col-md-4 mt-2">
            <label class="form-label">Placement</label>
            <select id="adPlacement" class="form-select">
              <option value="dashboard_top">Dashboard Top</option>
              <option value="dashboard_footer">Dashboard Footer</option>
              <option value="login_interstitial">Login Interstitial</option>
              <option value="email_banner">Email Banner</option>
            </select>
          </div>

          <div class="col-md-4 mt-2">
            <label class="form-label">Active</label>
            <select id="adActive" class="form-select">
              <option value="true">Active</option>
              <option value="false">Inactive</option>
            </select>
          </div>

          <div class="col-md-4 d-flex align-items-end mt-2">
            <button id="uploadAdBtn" class="btn btn-primary w-100">Upload / Save Ad</button>
          </div>
        </div>

        <hr/>
        <h6>Existing Ads</h6>
        <div id="adsList"></div>
      </div>
    </div>

    <!-- Approved users -->
    <div class="card mb-4">
      <div class="card-body">
        <h5>Approved Users</h5>
        <div class="table-responsive"><table class="table table-bordered"><thead><tr><th>Name</th><th>Role</th><th>Plan</th><th>Action</th></tr></thead><tbody id="approvedUsersTable"></tbody></table></div>
      </div>
    </div>

    <!-- Movement history -->
    <div class="card mb-4">
      <div class="card-body">
        <h5>Movement History</h5>
        <select id="historyUserSelect" class="form-select mb-2"><option value="">Select User</option></select>
        <button class="btn btn-secondary mb-2" id="loadHistoryBtn">Load History</button>
        <div id="historyMap" style="height:300px;"></div>
        <button class="btn btn-danger mt-2" id="deleteHistoryBtn" style="display:none">Delete All History</button>
      </div>
    </div>

  </div>

  <!-- Firebase libs -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
  // ====== CONFIG ======
  const firebaseConfig = {
    apiKey: "AIzaSyCn9YSO4-ksWl6JBqIcEEuLx2EJN8jMj4M",
    authDomain: "svms-c0232.firebaseapp.com",
    databaseURL: "https://svms-c0232-default-rtdb.firebaseio.com",
    projectId: "svms-c0232",
    storageBucket: "svms-c0232.appspot.com",
    messagingSenderId: "359201898609",
    appId: "1:359201898609:web:893ef076207abb06471bd0"
  };
  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();
  const storage = firebase.storage();

  // ====== Debug helpers ======
  const debugEl = document.getElementById('debugLog');
  const debugMode = true;
  function logDebug(...args){
    console.log(...args);
    if (!debugMode) return;
    const s = args.map(a => (typeof a === 'object' ? JSON.stringify(a,null,2) : String(a))).join(' ');
    debugEl.textContent = (debugEl.textContent || '') + s + '\n';
    debugEl.scrollTop = debugEl.scrollHeight;
  }

  // ====== UI refs ======
  const logoutBtn = document.getElementById('logoutBtn');
  const pendingUsersList = document.getElementById('pendingUsersList');
  const adsList = document.getElementById('adsList');
  const uploadAdBtn = document.getElementById('uploadAdBtn');
  const adFileInput = document.getElementById('adFile');
  const adUrlInput = document.getElementById('adUrl');
  const adTypeEl = document.getElementById('adType');
  const adPlacementEl = document.getElementById('adPlacement');
  const adActiveEl = document.getElementById('adActive');

  const historyUserSelect = document.getElementById('historyUserSelect');
  const loadHistoryBtn = document.getElementById('loadHistoryBtn');
  const deleteHistoryBtn = document.getElementById('deleteHistoryBtn');

  const approvedUsersTable = document.getElementById('approvedUsersTable');

  const totalCompaniesEl = document.getElementById('totalCompanies');
  const totalVehiclesEl = document.getElementById('totalVehicles');
  const totalDeliveriesEl = document.getElementById('totalDeliveries');
  const alertsTodayEl = document.getElementById('alertsToday');

  // ====== Map vars ======
  let liveMap, historyMap;
  let liveMarkers = {}; // keyed by vehicle id

  // ====== Utility: parse different location formats ======
  function parseLocation(loc){
    if(!loc) return null;
    if(typeof loc === 'string'){
      const parts = loc.split(',').map(p => p.trim()).filter(Boolean);
      if(parts.length >= 2){
        const lat = Number(parts[0]), lng = Number(parts[1]);
        if(!isNaN(lat) && !isNaN(lng)) return [lat,lng];
      }
    } else if(typeof loc === 'object'){
      // common variants
      if(loc.lat !== undefined && loc.lng !== undefined) return [Number(loc.lat), Number(loc.lng)];
      if(loc.latitude !== undefined && loc.longitude !== undefined) return [Number(loc.latitude), Number(loc.longitude)];
      if(Array.isArray(loc) && loc.length>=2) {
        const lat = Number(loc[0]), lng = Number(loc[1]);
        if(!isNaN(lat) && !isNaN(lng)) return [lat,lng];
      }
    }
    return null;
  }

  // ====== AUTH GUARD (more permissive check for admin flags) ======
  auth.onAuthStateChanged(async (user) => {
    if (!user) {
      logDebug('No user: redirecting to login');
      return location.href = 'login.html';
    }
    try {
      const snap = await db.ref(`users/${user.uid}`).once('value');
      const u = snap.val();
      logDebug('Signed in user record:', u);
      const isSuperAdmin = u && (u.role === 'super-admin' || u.role === 'admin' || u.isAdmin === true || u.admin === true);
      if(!isSuperAdmin){
        logDebug('User is not super-admin -> redirecting to dashboard');
        return location.href = 'dashboard.html';
      }
      init(user.uid);
    } catch(err){
      console.error(err);
      logDebug('Auth guard error: ' + err.message);
    }
  });

  logoutBtn.onclick = () => auth.signOut().then(()=>location.href='login.html');

  // ====== INIT ======
  function init(adminUid){
    setupLiveMap();
    setupHistoryMap();
    loadStats();
    loadPendingApprovals(); // sets up real-time listener
    loadApprovedUsers();    // sets up real-time listener
    loadUserDropdowns();
    loadAds();
    uploadAdBtn.onclick = handleUploadAd;
    loadHistoryBtn.onclick = handleLoadHistory;
    logDebug('Init finished for admin:', adminUid);
  }

  // ====== STATS (simple) ======
  function loadStats(){
    db.ref('users').once('value').then(snap=>{
      const users = snap.val()||{};
      let companiesSet = new Set(), vehicles = 0, deliveries = 0, alerts = 0;
      for(const uid in users){
        const u = users[uid];
        if (u && u.vehicle && u.vehicle.companies) {
          Object.keys(u.vehicle.companies).forEach(cn => companiesSet.add(cn));
          Object.values(u.vehicle.companies).forEach(comp => {
            const vehs = comp.vehicle||{};
            vehicles += Object.keys(vehs).length;
            Object.values(vehs).forEach(v => {
              if (v && v.deliveries) {
                const d = v.deliveries;
                deliveries += (typeof d === 'object' && !Array.isArray(d)) ? Object.keys(d).length : (Array.isArray(d) ? d.length : 0);
              }
            });
          });
        } else if (u && u.vehicles) {
          vehicles += Object.keys(u.vehicles).length;
        }
        if (u && u.vehicle && u.vehicle.last_trigger && u.vehicle.last_trigger.status === 'alert') alerts++;
      }
      totalCompaniesEl.innerText = companiesSet.size;
      totalVehiclesEl.innerText = vehicles;
      totalDeliveriesEl.innerText = deliveries;
      alertsTodayEl.innerText = alerts;
    }).catch(err => logDebug('Stats load error: ' + err.message));
  }

  // ====== PENDING APPROVALS: real-time listener and robust handling ======
  let usersListener = null;
  function loadPendingApprovals(){
    if(usersListener) db.ref('users').off('value', usersListener);
    usersListener = db.ref('users').on('value', snap=>{
      const users = snap.val() || {};
      pendingUsersList.innerHTML = '';
      let any = false;
      Object.entries(users).forEach(([uid, u])=>{
        // show pending if approved !== true (covers undefined/null/false)
        if (!u || u.approved !== true) {
          any = true;
          const name = (u && (u.companyName || u.displayName || u.email)) || uid;
          const roleLabel = (u && u.role) || 'unassigned';
          // detect requested plan from multiple possible keys
          const plan = (u && (u.requestedPlan || u.requested_plan || (u.request && u.request.plan) || (u.subscriptionRequest && u.subscriptionRequest.plan) || u.plan)) || 'N/A';
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-center';
          li.innerHTML = `<div>
              <strong>${escapeHtml(name)}</strong> <small class="text-muted">(${escapeHtml(roleLabel)})</small>
              <div class="text-muted small">Requested Plan: ${escapeHtml(plan)}</div>
              <div class="text-muted small">UID: ${uid}</div>
            </div>`;
          const actions = document.createElement('div');

          const approveBtn = document.createElement('button');
          approveBtn.className = 'btn btn-success btn-sm me-1';
          approveBtn.textContent = 'Approve';
          approveBtn.onclick = ()=> approveUser(uid, plan, roleLabel);

          const editBtn = document.createElement('button');
          editBtn.className = 'btn btn-sm btn-outline-primary me-1';
          editBtn.textContent = 'Details';
          editBtn.onclick = ()=> openUserDetails(uid);

          const rejectBtn = document.createElement('button');
          rejectBtn.className = 'btn btn-danger btn-sm';
          rejectBtn.textContent = 'Reject';
          rejectBtn.onclick = ()=> rejectUser(uid);

          actions.appendChild(approveBtn);
          actions.appendChild(editBtn);
          actions.appendChild(rejectBtn);
          li.appendChild(actions);
          pendingUsersList.appendChild(li);
        }
      });
      if(!any) pendingUsersList.innerHTML = `<li class="list-group-item text-muted">No pending approvals.</li>`;
    }, err => {
      logDebug('users on value error: ' + err.message);
    });
  }

  // ====== Approve / Reject ======
  function approveUser(uid, suggestedPlan = 'basic', suggestedRole = 'company'){
    // prompt admin to confirm/change plan/role
    const finalPlan = window.prompt('Set plan to assign (leave empty to use requested):', suggestedPlan) || suggestedPlan || 'basic';
    const roleInput = window.prompt('Set role for user (company/customer/super-admin):', suggestedRole) || suggestedRole || 'company';
    const payload = {
      approved: true,
      plan: finalPlan,
      role: roleInput,
      approvedAt: new Date().toISOString()
    };
    db.ref(`users/${uid}`).update(payload)
      .then(()=> {
        alert('User approved');
      })
      .catch(err => {
        alert('Approve failed: ' + err.message);
        logDebug('approveUser error', err);
      });
  }

  function rejectUser(uid){
    if(!confirm('Delete this user? This will remove the user node.')) return;
    db.ref(`users/${uid}`).remove()
      .then(()=> alert('User removed'))
      .catch(err => { alert('Remove failed: ' + err.message); logDebug('rejectUser error', err); });
  }

  // ====== Approved users (real-time) ======
  let approvedListener = null;
  function loadApprovedUsers(){
    if(approvedListener) db.ref('users').off('value', approvedListener);
    approvedListener = db.ref('users').on('value', snap=>{
      const users = snap.val() || {};
      let rows = '';
      Object.entries(users).forEach(([uid,u])=>{
        if(u && u.approved === true && (u.role === 'company' || u.role === 'customer' || u.role === 'super-admin' || u.role === 'admin')){
          rows += `<tr>
            <td>${escapeHtml(u.companyName || u.email || uid)}</td>
            <td>${escapeHtml(u.role)}</td>
            <td>${escapeHtml(u.plan || 'basic')}</td>
            <td><button class="btn btn-sm btn-outline-primary" onclick="openUserDetails('${uid}')">Open</button></td>
          </tr>`;
        }
      });
      approvedUsersTable.innerHTML = rows || `<tr><td colspan="4" class="text-muted">No approved users.</td></tr>`;
    }, err => logDebug('approved users listener error: ' + err.message));
  }

  // ====== Open details (global) ======
  window.openUserDetails = function(uid){
    db.ref(`users/${uid}`).once('value').then(snap=>{
      const u = snap.val() || {};
      const pretty = JSON.stringify(u, null, 2);
      // show basic alert (for quick) and console full
      alert(`User: ${u.companyName || u.email || uid}\nRole: ${u.role}\nPlan: ${u.plan || 'N/A'}\nUID: ${uid}`);
      console.log('Full user object:', u);
    }).catch(err => logDebug('openUserDetails error: ' + err.message));
  };

  // ====== Ads management (same approach but added debug) ======
  function loadAds(){
    adsList.innerHTML = '<div class="text-muted">Loading ads…</div>';
    db.ref('admin/ads').once('value').then(snap=>{
      const ads = snap.val() || {};
      adsList.innerHTML = '';
      Object.entries(ads).reverse().forEach(([key,ad])=>{
        const div = document.createElement('div');
        div.className = 'mb-2 p-2 border rounded bg-white';
        const created = ad.createdAt || '';
        div.innerHTML = `<div><strong>Placement:</strong> ${escapeHtml(ad.placement || '')} · <strong>Type:</strong> ${escapeHtml(ad.type||'')} · <small class="text-muted">${escapeHtml(created)}</small></div>`;
        const content = document.createElement('div');
        if(ad.type === 'banner'){
          content.innerHTML = ad.url ? `<img src="${ad.url}" style="max-width:320px;height:auto;border-radius:6px"/>` : `<small class="text-muted">No url</small>`;
        } else {
          content.innerHTML = ad.url ? `<video controls style="max-width:320px;border-radius:6px"><source src="${ad.url}"></video>` : `<small class="text-muted">No url</small>`;
        }
        const btns = document.createElement('div'); btns.className='mt-2';
        const toggleBtn = document.createElement('button'); toggleBtn.className='btn btn-sm btn-outline-secondary me-2';
        toggleBtn.textContent = ad.active ? 'Deactivate' : 'Activate';
        toggleBtn.onclick = ()=> {
          db.ref(`admin/ads/${key}/active`).set(!ad.active).then(()=> loadAds());
        };
        const delBtn = document.createElement('button'); delBtn.className='btn btn-sm btn-danger'; delBtn.textContent='Delete';
        delBtn.onclick = ()=> {
          if(!confirm('Delete this ad?')) return;
          db.ref(`admin/ads/${key}`).remove().then(()=> {
            if(ad.storagePath) storage.ref(ad.storagePath).delete().catch(()=>{/*ignore*/});
            loadAds();
          });
        };
        btns.appendChild(toggleBtn); btns.appendChild(delBtn);
        div.appendChild(content); div.appendChild(btns);
        adsList.appendChild(div);
      });
    }).catch(err => logDebug('loadAds error: ' + err.message));
  }

  async function handleUploadAd(){
    const placement = adPlacementEl.value;
    const type = adTypeEl.value;
    const active = adActiveEl.value === 'true';
    const urlProvided = (adUrlInput.value || '').trim();
    const file = adFileInput.files[0];
    const key = db.ref('admin/ads').push().key;
    const createdAt = new Date().toISOString();
    const adMeta = { placement, type, active, createdAt };
    try {
      if (file) {
        const path = `admin_ads/${key}/${file.name}`;
        const ref = storage.ref(path);
        await ref.put(file);
        const downloadUrl = await ref.getDownloadURL();
        adMeta.url = downloadUrl;
        adMeta.storagePath = path;
      } else if (urlProvided) {
        adMeta.url = urlProvided;
      } else {
        return alert('Provide a file or a URL.');
      }
      await db.ref(`admin/ads/${key}`).set(adMeta);
      adFileInput.value = ''; adUrlInput.value = '';
      alert('Ad saved.');
      loadAds();
    } catch(err){
      console.error(err); alert('Upload failed: '+err.message); logDebug('handleUploadAd error', err);
    }
  }

  // ====== Live map ======
  function setupLiveMap(){
    try {
      liveMap = L.map('map').setView([20,78],5);
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(liveMap);
    } catch(err){ logDebug('Leaflet init error: ' + err.message); return; }

    // real-time user -> markers
    db.ref('users').on('value', snap => {
      const users = snap.val() || {};
      // remove previous markers
      Object.values(liveMarkers || {}).forEach(m => { try{ liveMap.removeLayer(m); }catch(e){} });
      liveMarkers = {};
      Object.entries(users).forEach(([uid, u]) => {
        if(!u) return;
        // traverse possible structure: u.vehicle.companies -> comp.vehicle -> individual vehicles
        if(u.vehicle && u.vehicle.companies) {
          Object.entries(u.vehicle.companies).forEach(([cname, comp])=>{
            const vehs = comp.vehicle || {};
            Object.entries(vehs).forEach(([vid, v])=>{
              try {
                const gpsCandidates = [v && v.gps, v && v.last_gps, v && v.location, v && v.lastLocation, (v && v.coords) || null];
                let pt = null;
                for(const candidate of gpsCandidates){
                  pt = parseLocation(candidate);
                  if(pt) break;
                }
                if(!pt) return;
                const marker = L.marker(pt).addTo(liveMap).bindPopup(`${escapeHtml(String(vid))} (${escapeHtml(String(cname))})`);
                liveMarkers[vid] = marker;
              } catch(err) {
                logDebug('marker add error', err);
              }
            });
          });
        } else if (u.vehicles) {
          // alternate structure
          Object.entries(u.vehicles).forEach(([vid, v])=>{
            const pt = parseLocation(v && (v.gps || v.location || v.last_gps));
            if(!pt) return;
            const marker = L.marker(pt).addTo(liveMap).bindPopup(`${escapeHtml(String(vid))}`);
            liveMarkers[vid] = marker;
          });
        }
      });
    }, err => logDebug('live map users listener error: ' + err.message));
  }

  // ====== History map ======
  function setupHistoryMap(){
    historyMap = L.map('historyMap').setView([20,78],5);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(historyMap);
  }

  function clearHistoryMap(){
    if(!historyMap) return;
    historyMap.eachLayer(layer => {
      if(layer instanceof L.Polyline || layer instanceof L.Marker || layer instanceof L.CircleMarker) historyMap.removeLayer(layer);
    });
  }

  function handleLoadHistory(){
    const uid = historyUserSelect.value;
    if(!uid) return alert('Select user');
    db.ref(`users/${uid}/vehicle/history`).once('value').then(snap=>{
      const hist = snap.val() || {};
      const pts = [];
      Object.values(hist).forEach(h => {
        let loc = null;
        if(typeof h === 'string') loc = h;
        else if(h && h.location) loc = h.location;
        else if(h && (h.lat && h.lng)) loc = `${h.lat},${h.lng}`;
        if(loc){
          const arr = loc.split(',').map(Number);
          if(!isNaN(arr[0]) && !isNaN(arr[1])) pts.push(arr);
        }
      });
      if(pts.length === 0) return alert('No valid history');
      clearHistoryMap();
      const poly = L.polyline(pts, {}).addTo(historyMap);
      historyMap.fitBounds(poly.getBounds());
      deleteHistoryBtn.style.display = 'inline-block';
      deleteHistoryBtn.onclick = ()=> deleteHistoryByUser(uid);
    }).catch(err => logDebug('handleLoadHistory error: ' + err.message));
  }

  function deleteHistoryByUser(uid){
    if(!confirm('Delete all movement history for this user?')) return;
    db.ref(`users/${uid}/vehicle/history`).set(null).then(()=> {
      alert('History deleted'); clearHistoryMap(); deleteHistoryBtn.style.display='none';
    }).catch(err=>{ alert('Error: '+err.message); logDebug('deleteHistory error', err); });
  }

  // ====== Dropdowns ======
  function loadUserDropdowns(){
    historyUserSelect.innerHTML = '<option value="">Select User</option>';
    db.ref('users').once('value').then(snap=>{
      const users = snap.val() || {};
      Object.entries(users).forEach(([uid, u])=>{
        if(u && (u.role === 'company' || u.role === 'customer' || u.approved === true)) {
          const label = u.companyName || u.email || uid;
          const opt = document.createElement('option');
          opt.value = uid;
          opt.textContent = label;
          historyUserSelect.appendChild(opt);
        }
      });
    }).catch(err => logDebug('loadUserDropdowns error: ' + err.message));
  }

  // ====== small escape helper ======
  function escapeHtml(s){
    if(!s && s !== 0) return '';
    return String(s).replace(/[&<>"'`=\/]/g, function (c) {
      return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;','/':'&#x2F;','`':'&#x60;','=':'&#x3D;'}[c];
    });
  }

  // end script
  </script>
</body>
</html>
